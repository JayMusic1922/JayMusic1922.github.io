<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>The Family Store</title>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #222;
    }

    /* Fondo difuminado */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url("fondo.png") center/cover no-repeat;
      filter: blur(8px) brightness(0.7);
      transform: scale(1.05);
      z-index: -2;
    }
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.25);
      z-index: -1;
    }

    .contenedor {
      max-width: 700px;
      margin: 40px auto;
      background: rgba(255,255,255,0.9);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .pulsera {
      border: 2px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      background: #fff;
    }

    .pulsera h3 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0;
    }

    .btn-borrar {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: #d32f2f;
    }

    .decoracion {
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .contador {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .contador button {
      width: 30px;
      height: 30px;
      border: none;
      border-radius: 5px;
      background: #f57c00;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .contador button:hover {
      background: #ef6c00;
    }

    .contador input {
      width: 40px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
      height: 30px;
    }

    .subtotal {
      margin-top: 10px;
      font-weight: bold;
      text-align: right;
    }

    #total {
      font-size: 22px;
      font-weight: bold;
      margin-top: 20px;
      text-align: center;
    }

    #agregarPulsera {
      display: block;
      margin: 0 auto;
      padding: 10px 20px;
      background: #388e3c;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }

    #agregarPulsera:hover {
      background: #2e7d32;
    }

    .botones-exportar {
      margin-top: 20px;
      text-align: center;
    }

    .botones-exportar button {
      background: #4CAF50;
      color: white;
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .botones-exportar button:hover {
      background: #45a049;
    }

    .botones-exportar .whatsapp {
      background: #25D366;
    }
    .botones-exportar .whatsapp:hover {
      background: #1ebe5d;
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <h1><img src="logo.png" alt="logo" style="height:200px; vertical-align:middle;"> The Family Store</h1>
    <p>Arma tus pulseras con las decoraciones que quieras. üß°üñ§</p>

    <div id="pulseras">
      <div class="pulsera">
        <h3>Pulsera 1 <button class="btn-borrar">üóëÔ∏è</button></h3>

        <div class="decoracion">
          <span>Coraz√≥n ($2000)</span><br><img src="logo.png" alt="logo" style="height:50px; vertical-align:middle;">
          <div class="contador">
            <button class="menos">-</button>
            <input type="text" value="0" readonly data-precio="2000">
            <button class="mas">+</button>
          </div>
        </div>

        <div class="decoracion">
          <span>Estrella ($1500)</span>
          <div class="contador">
            <button class="menos">-</button>
            <input type="text" value="0" readonly data-precio="1500">
            <button class="mas">+</button>
          </div>
        </div>

        <div class="decoracion">
          <span>Inicial personalizada ($1800)</span>
          <div class="contador">
            <button class="menos">-</button>
            <input type="text" value="0" readonly data-precio="1800">
            <button class="mas">+</button>
          </div>
        </div>

        <div class="decoracion">
          <span>Dije varios ($2500)</span>
          <div class="contador">
            <button class="menos">-</button>
            <input type="text" value="0" readonly data-precio="2500">
            <button class="mas">+</button>
          </div>
        </div>

        <div style="margin-top:15px;">
          <label>Detalles (color, grosor, etc):</label>
          <textarea class="notas" rows="2"
                    style="width:100%; border-radius:8px; padding:8px; margin-top:5px; border:1px solid #ccc; resize:vertical;"></textarea>
        </div>

        <div class="subtotal">Subtotal: $2000 COP</div>
      </div>
    </div>

    <button id="agregarPulsera">‚ûï Agregar otra pulsera</button>
    <div id="total">Total: $2000 COP</div>

    <div class="botones-exportar">
      <button onclick="descargarPDF()">üìÑ Descargar Vale en PDF</button>
      <button class="whatsapp" onclick="enviarWhatsApp()">üí¨ Enviar por WhatsApp</button>
    </div>
  </div>

<script>
const WHATSAPP_NUM = "573014348004"; 
const MANO_OBRA = 2000;

/* Extraer nombre y precio */
function obtenerNombreYPrecio(deco, input) {
  const span = deco.querySelector("span");
  let textoSpan = span ? span.textContent.trim() : "";
  const nombre = textoSpan.replace(/\s*\(\s*\$?[0-9.,]+\s*\)\s*$/g, "").trim();
  const precio = parseInt(input.dataset.precio || "0", 10);
  return { nombre, precio };
}

/* Actualizar totales en pantalla */
function actualizarTotales() {
  let totalGeneral = 0;
  document.querySelectorAll(".pulsera").forEach((pulsera, i) => {
    let subtotalPulsera = MANO_OBRA;

    pulsera.querySelectorAll(".decoracion").forEach(deco => {
      const input = deco.querySelector("input");
      const cantidad = parseInt(input.value || "0", 10);
      const { precio } = obtenerNombreYPrecio(deco, input);
      subtotalPulsera += cantidad * precio;
    });

    const subtotalDiv = pulsera.querySelector(".subtotal");
    if (subtotalDiv) {
      subtotalDiv.textContent = `Subtotal: $${subtotalPulsera.toLocaleString("es-CO")} COP`;
    }

    totalGeneral += subtotalPulsera;
  });

  document.getElementById("total").textContent = `Total: $${totalGeneral.toLocaleString("es-CO")} COP`;
}

/* Generar resumen */
function generarResumenTexto() {
  let resumen = "Resumen de pedido - The Family Store\n\n";
  let totalGeneral = 0;
  const pulseras = document.querySelectorAll(".pulsera");

  if (pulseras.length === 0) {
    resumen += "No hay pulseras seleccionadas.\n\n";
  }

  pulseras.forEach((pulsera, i) => {
    resumen += `Pulsera ${i+1}:\n`;
    let subtotalPulsera = MANO_OBRA;

    pulsera.querySelectorAll(".decoracion").forEach(deco => {
      const input = deco.querySelector("input");
      const cantidad = parseInt(input.value || "0", 10);
      if (cantidad > 0) {
        const { nombre, precio } = obtenerNombreYPrecio(deco, input);
        const subtotalItem = cantidad * precio;
        resumen += ` - ${nombre} ($${precio.toLocaleString("es-CO")}) x${cantidad} = $${subtotalItem.toLocaleString("es-CO")} COP\n`;
        subtotalPulsera += subtotalItem;
      }
    });

    const notas = pulsera.querySelector(".notas")?.value.trim();
    if (notas) resumen += `   Notas: ${notas}\n`;

    resumen += ` Mano de obra: $${MANO_OBRA.toLocaleString("es-CO")} COP\n`;
    resumen += ` Subtotal Pulsera ${i+1}: $${subtotalPulsera.toLocaleString("es-CO")} COP\n\n`;

    totalGeneral += subtotalPulsera;
  });

  resumen += `Total: $${totalGeneral.toLocaleString("es-CO")} COP\n`;
  return { texto: resumen, total: totalGeneral };
}

/* Descargar PDF */
function descargarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });

  const { texto } = generarResumenTexto();
  const lines = doc.splitTextToSize(texto, 520);

  doc.setFont("helvetica", "normal");
  doc.setFontSize(12);

  let y = 40;
  lines.forEach(line => {
    if (y > 800) {
      doc.addPage();
      y = 40;
    }
    doc.text(line, 40, y);
    y += 14;
  });

  doc.save("vale_compra.pdf");
}

/* Enviar por WhatsApp */
function enviarWhatsApp() {
  const { texto } = generarResumenTexto();
  const numero = WHATSAPP_NUM.replace(/\D/g, "");
  const url = `https://wa.me/${numero}?text=${encodeURIComponent(texto)}`;
  window.open(url, "_blank");
}

/* Delegaci√≥n de eventos */
document.addEventListener("click", e => {
  if (e.target.classList.contains("mas")) {
    const input = e.target.parentElement.querySelector("input");
    input.value = parseInt(input.value || "0", 10) + 1;
    actualizarTotales();
  }

  if (e.target.classList.contains("menos")) {
    const input = e.target.parentElement.querySelector("input");
    input.value = Math.max(0, parseInt(input.value || "0", 10) - 1);
    actualizarTotales();
  }

  if (e.target.classList.contains("btn-borrar")) {
    e.target.closest(".pulsera").remove();
    actualizarTotales();
  }

  if (e.target.id === "agregarPulsera") {
    const contenedor = document.getElementById("pulseras");
    const primera = contenedor.querySelector(".pulsera");
    const copia = primera.cloneNode(true);

    copia.querySelectorAll("input").forEach(input => input.value = "0");
    copia.querySelectorAll("textarea").forEach(area => area.value = "");
    copia.querySelector(".subtotal").textContent = `Subtotal: $${MANO_OBRA.toLocaleString("es-CO")} COP`;

    contenedor.appendChild(copia);
    actualizarTotales();
  }
});

/* Inicializar totales */
document.addEventListener("DOMContentLoaded", actualizarTotales);
</script>

</body>
</html>


























